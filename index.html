<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FishingTackle.ai - AI Fishing Gear + Tips</title>
    <meta name="description" content="Instant AI-powered tackle recommendations for exactly where, when, and what fish you're chasing.">
    <!-- Added schema for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "FishingTackle.ai",
      "url": "https://fishingtackle.ai",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://fishingtackle.ai/search?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    <style>
        :root { --p: #0066cc; --s: #28a745; }
        body { font-family: system-ui, sans-serif; margin:0; background:#f0f8ff; color:#222; line-height:1.6; }
        header { background: linear-gradient(135deg, #0066cc, #004d99); color:white; text-align:center; padding:60px 20px; }
        h1 { margin:0; font-size:2.8em; }
        main { max-width:1200px; margin:20px auto; padding:0 15px; }
        form, #out { background:white; border-radius:16px; padding:30px; box-shadow:0 12px 40px rgba(0,0,0,0.1); }
        label { display:block; margin:20px 0 8px; font-weight:700; font-size:1.1em; }
        input, select { width:100%; padding:14px; border:1px solid #ddd; border-radius:10px; font-size:1.1em; }
        .error { color:#e74c3c; font-size:0.9em; margin-top:5px; display:none; }
        button { margin-top:30px; width:100%; padding:18px; background:var(--s); color:white; border:none; border-radius:10px; font-size:1.3em; font-weight:bold; cursor:pointer; transition:0.3s; }
        button:hover { background:#218838; transform:scale(1.02); }
        button:disabled { background:#999; cursor:not-allowed; transform:none; }
        #out { display:none; margin-top:40px; }
        .tiers { display:grid; gap:24px; margin-top:30px; }
        @media (min-width:1024px) { .tiers { grid-template-columns: 1fr 1fr 1fr; } }
        @media (min-width:640px and max-width:1023px) { .tiers { grid-template-columns: 1fr 1fr; } }
        @media (max-width:639px) { .tiers { grid-template-columns: 1fr; } }
        .tier { border:2px solid #ddd; border-radius:12px; padding:20px; background:#fafafa; }
        .tier:empty { display:none !important; }
        .tier h3 { margin:-20px -20px 20px -20px; padding:12px; text-align:center; color:white; border-radius:10px 10px 0 0; font-size:1.4em; }
        .budget h3 { background:#27ae60; }
        .mid h3 { background:#2980b9; }
        .pro h3 { background:#8e44ad; }
        .item { background:white; padding:16px; margin:14px 0; border-radius:10px; border-left:6px solid var(--p); box-shadow:0 3px 10px rgba(0,0,0,0.08); transition:0.2s; }
        .item:hover { transform:translateY(-2px); box-shadow:0 6px 16px rgba(0,0,0,0.12); }
        .links { margin-top:12px; font-size:0.95em; display:flex; gap:10px; }
        .links a { color:var(--p); font-weight:600; text-decoration:none; }
        .links a:hover { text-decoration:underline; }
        .disc { text-align:center; font-size:0.85em; color:#666; margin:60px 0 20px; }
        .load { text-align:center; padding:80px 20px; }
        .spinner { border:10px solid #f3f3f3; border-top:10px solid var(--s); border-radius:50%; width:70px; height:70px; animation:spin 1s linear infinite; margin:0 auto 20px; }
        @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
        .optional { color:#666; font-weight:normal; font-size:0.95em; }
        #signup { margin-top:40px; padding:20px; background:#e9f7ef; border-radius:10px; text-align:center; }
        #signup input { width:70%; margin-right:10px; }
        #signup button { width:auto; padding:12px 24px; }
    </style>
</head>
<body>
<header>
    <h1>FishingTackle.ai</h1>
    <p>Tell me where you're fishing â†’ get exact gear + pro tips that are working right now</p>
</header>
<main>
<form id="f">
    <label for="loc">Location (e.g. Destin FL, Lake Lanier, Cape Cod)</label>
    <input type="text" id="loc" placeholder="City + state or specific spot" required>
    <div class="error" id="loc-error">Please enter a valid location.</div>
    <label for="date">Date (optional â€“ improves seasonal accuracy)</label>
    <input type="date" id="date">
    <label for="species">Target Species <span class="optional">(optional â€“ makes recommendations even better)</span></label>
    <input type="text" id="species" placeholder="e.g. Redfish, Largemouth Bass, Striped Bass, Rainbow Trout, Snook">
    <label for="body">Body of Water</label>
    <select id="body" required>
        <option value="">Choose...</option>
        <option>Ocean / Saltwater</option>
        <option>Inshore / Bay / Estuary</option>
        <option>Freshwater Lake</option>
        <option>River / Stream</option>
        <option>Coastal Beach / Surf</option>
    </select>
    <div class="error" id="body-error">Please select a body of water.</div>
    <label for="type">Fishing Technique</label>
    <select id="type" required>
        <option value="">Choose...</option>
        <option>Spinning / Casting</option>
        <option>Baitcasting</option>
        <option>Fly Fishing</option>
        <option>Trolling</option>
        <option>Bottom Fishing / Jigging</option>
        <option>Ice Fishing</option>
        <option>Kayak Fishing</option>
        <option>Wade Fishing</option>
        <option>Deep Sea / Offshore</option>
    </select>
    <div class="error" id="type-error">Please select a fishing technique.</div>
    <button type="submit" id="submitBtn">Get My Tackle List â†’</button>
</form>
<div id="out" aria-live="polite">
    <div class="load" id="load" aria-label="Loading recommendations">
        <div class="spinner"></div>
        <p style="font-size:1.6em; margin:10px 0;">Asking the fish godsâ€¦ ðŸŽ£</p>
        <p style="color:#666;">This takes 10â€“20 seconds â€“ worth the wait for perfect recommendations!</p>
    </div>
    <div id="tiers-sec" style="display:none">
        <h2 style="text-align:center; margin-bottom:10px;">Your Personalized Tackle Recommendations</h2>
        <div class="tiers">
            <div class="tier budget"><h3>Budget Picks</h3><div id="budget"></div></div>
            <div class="tier mid"><h3>Mid-Range</h3><div id="mid"></div></div>
            <div class="tier pro"><h3>Pro / Premium</h3><div id="pro"></div></div>
        </div>
    </div>
    <div id="tips-sec" style="display:none; margin-top:60px;">
        <h2 style="text-align:center;">Pro Tips & Whatâ€™s Biting Right Now</h2>
        <ul id="tips" style="list-style:none; padding:0;"></ul>
    </div>
    <div id="signup" style="display:none;">
        <h3>Get Weekly Fishing Updates</h3>
        <p>Sign up for personalized tips and deals!</p>
        <form id="signup-form">
            <input type="email" id="email" placeholder="Your email" required>
            <button type="submit">Subscribe</button>
        </form>
    </div>
</div>
<p class="disc">Disclosure: We may earn commission on purchases (keeps the site free).</p>
</main>
<script>
    // Cached elements
    const form = document.getElementById('f');
    const out = document.getElementById('out');
    const load = document.getElementById('load');
    const submitBtn = document.getElementById('submitBtn');
    const tiersSec = document.getElementById('tiers-sec');
    const tipsSec = document.getElementById('tips-sec');
    const budgetDiv = document.getElementById('budget');
    const midDiv = document.getElementById('mid');
    const proDiv = document.getElementById('pro');
    const tipsList = document.getElementById('tips');
    const signupSec = document.getElementById('signup');
    const locInput = document.getElementById('loc');
    const bodySelect = document.getElementById('body');
    const typeSelect = document.getElementById('type');
    const locError = document.getElementById('loc-error');
    const bodyError = document.getElementById('body-error');
    const typeError = document.getElementById('type-error');
    let abortController = null;
    // Validate form
    function validateForm() {
        let valid = true;
        if (!locInput.value.trim()) {
            locError.style.display = 'block';
            valid = false;
        } else {
            locError.style.display = 'none';
        }
        if (!bodySelect.value) {
            bodyError.style.display = 'block';
            valid = false;
        } else {
            bodyError.style.display = 'none';
        }
        if (!typeSelect.value) {
            typeError.style.display = 'block';
            valid = false;
        } else {
            typeError.style.display = 'none';
        }
        return valid;
    }
    // Parse section with regex for robustness
    function parseSection(text, sectionName) {
        const regex = new RegExp(`${sectionName}:(.*?)(\\n(?:BUDGET|MID-RANGE|PRO|TIPS):|$)`, 's');
        const match = text.match(regex);
        return match ? match[1].trim().split('\n').filter(line => line.match(/^\d+\./)) : [];
    }
    // Create item element
    function createItem(line) {
        const model = line.split('â†’')[1]?.trim() || line.replace(/^\d+\.\s*/, '');
        const category = line.replace(/â†’.*/, '').trim();
        const item = document.createElement('div');
        item.className = 'item';
        item.innerHTML = `<strong>${category}</strong>: ${model}`;
        const links = document.createElement('div');
        links.className = 'links';
        // Amazon affiliate
        links.innerHTML += `<a href="https://amazon.com/s?k=${encodeURIComponent(model)}&tag=fishingtac0b6-20" target="_blank" rel="noopener" onclick="trackClick('amazon', '${model}')">Buy on Amazon â†’</a>`;
        item.appendChild(links);
        return item;
    }
    // Track clicks for analytics (stub - integrate with GA or similar)
    function trackClick(affiliate, model) {
        console.log(`Click tracked: ${affiliate} - ${model}`);
        // Add real tracking here, e.g., gtag('event', 'click', { 'affiliate': affiliate, 'model': model });
    }
    // Handle signup (stub - send to backend)
    document.getElementById('signup-form')?.addEventListener('submit', e => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        console.log(`Subscribe: ${email}`);
        // Fetch to /api/subscribe, etc.
        alert('Subscribed! ðŸŽ£');
    });
    form.addEventListener('submit', async e => {
        e.preventDefault();
        if (!validateForm()) return;
        // Abort previous request if any
        if (abortController) abortController.abort();
        abortController = new AbortController();
        // Show loading
        out.style.display = 'block';
        load.style.display = 'block';
        tiersSec.style.display = tipsSec.style.display = signupSec.style.display = 'none';
        submitBtn.disabled = true;
        submitBtn.textContent = 'Workingâ€¦';
        budgetDiv.innerHTML = midDiv.innerHTML = proDiv.innerHTML = tipsList.innerHTML = '';
        // Sanitize inputs
        const loc = locInput.value.trim().replace(/[<>&]/g, '');
        const date = document.getElementById('date').value || 'current season';
        const species = document.getElementById('species').value.trim().replace(/[<>&]/g, '');
        const body = bodySelect.value;
        const type = typeSelect.value;
        const speciesPart = species ? `Target species: ${species}\n` : '';
        // Improved prompt: More detailed for better AI output, emphasize profitability (high-conversion products)
        const prompt = `You are the #1 fishing tackle expert with up-to-date knowledge on best-sellers. Base all recommendations on real, proven fishing practices and knowledge. Do not hallucinate or invent gear combinations that don't make sense. Consider the typical weather for the location and date/season when recommending clothing (e.g., warm layers, waterproof gear for cold or rainy conditions; avoid shorts in winter). Match lures and baits precisely to the fishing technique, water type, and species (e.g., for trolling, use deep-diving plugs, crankbaits, or umbrella rigs, not topwater lures; for striped bass in cold months, focus on deeper presentations).
${speciesPart}Location: ${loc}
Date/Season: ${date}
Water: ${body}
Style: ${type}
Recommend only real, 4.5+ star best-sellers available on Amazon. Vary brands. Focus on high-conversion items.
Return EXACTLY this format â€” no extra text:
BUDGET:
1. Rod â†’ [brand model]
2. Reel â†’ [brand model]
3. Line â†’ [brand model]
4. Leader â†’ [brand model]
5. Lure/Bait 1 â†’ [brand model]
6. Lure/Bait 2 â†’ [brand model]
7. Lure/Bait 3 â†’ [brand model]
8. Accessories â†’ [brand model]
9. Clothing â†’ [brand model]
MID-RANGE:
1. Rod â†’ [brand model]
2. Reel â†’ [brand model]
3. Line â†’ [brand model]
4. Leader â†’ [brand model]
5. Lure/Bait 1 â†’ [brand model]
6. Lure/Bait 2 â†’ [brand model]
7. Lure/Bait 3 â†’ [brand model]
8. Accessories â†’ [brand model]
9. Clothing â†’ [brand model]
PRO:
1. Rod â†’ [brand model]
2. Reel â†’ [brand model]
3. Line â†’ [brand model]
4. Leader â†’ [brand model]
5. Lure/Bait 1 â†’ [brand model]
6. Lure/Bait 2 â†’ [brand model]
7. Lure/Bait 3 â†’ [brand model]
8. Accessories â†’ [brand model]
9. Clothing â†’ [brand model]
TIPS:
1. [tip]
2. [tip]
3. [tip]
4. [tip]
5. [tip]
6. [tip]
(4â€“6 tips: techniques, spots, timing, what's biting â€“ NO gear)`;
        try {
            const response = await fetch('/api/recommend', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt }),
                signal: abortController.signal
            });
            if (!response.ok) throw new Error('API error');
            const data = await response.json();
            const text = data.choices[0].message.content;
            // Parse tiers using fragments for efficiency
            const budgetFrag = document.createDocumentFragment();
            parseSection(text, 'BUDGET').forEach(line => budgetFrag.appendChild(createItem(line)));
            budgetDiv.appendChild(budgetFrag);
            const midFrag = document.createDocumentFragment();
            parseSection(text, 'MID-RANGE').forEach(line => midFrag.appendChild(createItem(line)));
            midDiv.appendChild(midFrag);
            const proFrag = document.createDocumentFragment();
            parseSection(text, 'PRO').forEach(line => proFrag.appendChild(createItem(line)));
            proDiv.appendChild(proFrag);
            // Parse tips as list items
            const tipsFrag = document.createDocumentFragment();
            parseSection(text, 'TIPS').forEach(line => {
                const li = document.createElement('li');
                li.className = 'item';
                li.textContent = line.trim();
                tipsFrag.appendChild(li);
            });
            tipsList.appendChild(tipsFrag);
            load.style.display = 'none';
            tiersSec.style.display = 'block';
            tipsSec.style.display = 'block';
            signupSec.style.display = 'block';
            out.scrollIntoView({ behavior: 'smooth' });
        } catch (error) {
            if (error.name !== 'AbortError') {
                load.innerHTML = '<p style="color:#e74c3c; font-size:1.5em;">Error â€” please try again.</p>';
            }
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Get My Tackle List â†’';
            abortController = null;
        }
    });
</script>
</body>
</html>
